<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Aggregate Records by Specified Time Period — count_by_period • c4cp</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate Records by Specified Time Period — count_by_period"><meta name="description" content="Transforms a date column in a dbplyr table connected to BigQuery by truncating each date to the start of the specified period (week, month, or quarter) and aggregates the data by counting the number of records in each period."><meta property="og:description" content="Transforms a date column in a dbplyr table connected to BigQuery by truncating each date to the start of the specified period (week, month, or quarter) and aggregates the data by counting the number of records in each period."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">c4cp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/count_by_period_vignette.html">Aggregating Recruitment Data by Time Period</a></li>
    <li><a class="dropdown-item" href="../articles/using_hello_function.html">How to use the hello function</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Analyticsphere/c4cp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Aggregate Records by Specified Time Period</h1>
      <small class="dont-index">Source: <a href="https://github.com/Analyticsphere/c4cp/blob/main/R/count_by_period.R" class="external-link"><code>R/count_by_period.R</code></a></small>
      <div class="d-none name"><code>count_by_period.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Transforms a date column in a <code>dbplyr</code> table connected to BigQuery by truncating each date to the start of the specified period (week, month, or quarter) and aggregates the data by counting the number of records in each period.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">count_by_period</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">date_col</span>, period <span class="op">=</span> <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="st">"MONDAY"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tbl">tbl<a class="anchor" aria-label="anchor" href="#arg-tbl"></a></dt>
<dd><p>A <code>dbplyr</code> table object connected to BigQuery. Typically obtained using <code>tbl(con, "table_name")</code>.</p></dd>


<dt id="arg-date-col">date_col<a class="anchor" aria-label="anchor" href="#arg-date-col"></a></dt>
<dd><p>A quoted or unquoted column name representing the date to be transformed and aggregated. Utilizes tidy evaluation for flexibility.</p></dd>


<dt id="arg-period">period<a class="anchor" aria-label="anchor" href="#arg-period"></a></dt>
<dd><p>A character string specifying the aggregation period. Acceptable values are <code>"week"</code>, <code>"month"</code>, and <code>"quarter"</code>. Defaults to <code>"week"</code>.</p></dd>


<dt id="arg-week-start">week_start<a class="anchor" aria-label="anchor" href="#arg-week-start"></a></dt>
<dd><p>A character string indicating the starting day of the week when <code>period = "week"</code>. Acceptable values are <code>"MONDAY"</code> and <code>"SUNDAY"</code>. Defaults to <code>"MONDAY"</code>. This parameter is ignored when <code>period = "month"</code> or <code>"quarter"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>dbplyr</code> table object containing two columns:</p><dl><dt><code>period_start</code></dt>
<dd><p>The start date of the aggregation period (Monday for weeks, the first day of the month for months, and the first day of the quarter for quarters).</p></dd>

  <dt><code>num_records</code></dt>
<dd><p>The count of records within each aggregation period.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>count_by_period</code> function is designed to streamline the process of aggregating time-series data by specified periods. It leverages the <code>dplyr</code> and <code>dbplyr</code> packages to translate R code into optimized SQL queries compatible with BigQuery.</p>
<p><strong>Key Features:</strong></p><ul><li><p>**Flexible Aggregation:** Supports weekly, monthly, and quarterly aggregations.</p></li>
<li><p>**Custom Week Start:** Allows specification of the week's starting day (Monday or Sunday) for weekly aggregations.</p></li>
<li><p>**Tidy Evaluation:** Accepts both quoted and unquoted column names for ease of use.</p></li>
<li><p>**Performance Optimized:** Designed to work efficiently with large datasets in BigQuery by translating operations into SQL.</p></li>
</ul><p><strong>Note:</strong> Ensure that the <code>date_col</code> contains valid date values to prevent errors during the transformation process. The function automatically filters out <code>NULL</code> dates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Load necessary libraries</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbplyr.tidyverse.org/" class="external-link">dbplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bigrquery.r-dbi.org" class="external-link">bigrquery</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Establish a connection to BigQuery</span></span></span>
<span class="r-in"><span><span class="va">project_id</span> <span class="op">&lt;-</span> <span class="st">"your-project-id"</span></span></span>
<span class="r-in"><span><span class="va">dataset_id</span> <span class="op">&lt;-</span> <span class="st">"your_dataset"</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">bigrquery</span><span class="fu">::</span><span class="fu">bigquery</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  project <span class="op">=</span> <span class="va">project_id</span>,</span></span>
<span class="r-in"><span>  dataset <span class="op">=</span> <span class="va">dataset_id</span>,</span></span>
<span class="r-in"><span>  use_legacy_sql <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reference your BigQuery table</span></span></span>
<span class="r-in"><span><span class="va">your_table</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">con</span>, <span class="st">"your_table"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate counts by week (default settings)</span></span></span>
<span class="r-in"><span><span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="fu">count_by_period</span><span class="op">(</span><span class="va">your_table</span>, <span class="va">p.d_471593703</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weekly_counts_local</span> <span class="op">&lt;-</span> <span class="va">weekly_counts</span> <span class="op">%&gt;%</span> <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">weekly_counts_local</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate counts by week starting on Sunday</span></span></span>
<span class="r-in"><span><span class="va">weekly_sunday_counts</span> <span class="op">&lt;-</span> <span class="fu">count_by_period</span><span class="op">(</span><span class="va">your_table</span>, <span class="va">p.d_471593703</span>, period <span class="op">=</span> <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="st">"SUNDAY"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weekly_sunday_counts_local</span> <span class="op">&lt;-</span> <span class="va">weekly_sunday_counts</span> <span class="op">%&gt;%</span> <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">weekly_sunday_counts_local</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate counts by month</span></span></span>
<span class="r-in"><span><span class="va">monthly_counts</span> <span class="op">&lt;-</span> <span class="fu">count_by_period</span><span class="op">(</span><span class="va">your_table</span>, <span class="va">p.d_471593703</span>, period <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">monthly_counts_local</span> <span class="op">&lt;-</span> <span class="va">monthly_counts</span> <span class="op">%&gt;%</span> <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">monthly_counts_local</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate counts by quarter</span></span></span>
<span class="r-in"><span><span class="va">quarterly_counts</span> <span class="op">&lt;-</span> <span class="fu">count_by_period</span><span class="op">(</span><span class="va">your_table</span>, <span class="va">p.d_471593703</span>, period <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">quarterly_counts_local</span> <span class="op">&lt;-</span> <span class="va">quarterly_counts</span> <span class="op">%&gt;%</span> <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">quarterly_counts_local</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Peters, Rebecca Sansale.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

